<!DOCTYPE html>
<html>
<head>
    <title>Admin Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-storage-compat.js"></script>
</head>
<body>
    <div class="container mt-5">
        <!-- Login Form -->
        <div id="login-section">
            <h2>Admin Login</h2>
            <input type="email" id="email" placeholder="Email" class="form-control mb-2">
            <input type="password" id="password" placeholder="Password" class="form-control mb-2">
            <button onclick="login()" class="btn btn-primary">Login</button>
        </div>

        <!-- Dashboard (Hidden Initially) -->
        <div id="dashboard-section" style="display:none;">
            <h2>Upload Questions</h2>
            <input type="file" id="file" class="form-control mb-2">
            <button onclick="upload()" class="btn btn-success">Upload</button>
            <button onclick="logout()" class="btn btn-danger">Logout</button>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCEvbG18_PQ-j6xMtuYDGBS_G6IRsBgZVs",
            authDomain: "questionpaperadmin.firebaseapp.com",
            projectId: "questionpaperadmin",
            storageBucket: "questionpaperadmin.firebasestorage.app",  // Fixed syntax
            appId: "1:315414139864:web:50fea187a8f2e34c7298ad"
        };

        // Initialize after DOM loads
        document.addEventListener('DOMContentLoaded', function() {
            firebase.initializeApp(firebaseConfig);
            console.log("Firebase initialized!");
            
            // Auto-redirect if already logged in
            firebase.auth().onAuthStateChanged(user => {
                if (user) {
                    document.getElementById('login-section').style.display = 'none';
                    document.getElementById('dashboard-section').style.display = 'block';
                }
            });
        });

        function login() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            if (!email || !password) {
                alert("Please enter both email and password");
                return;
            }

            firebase.auth().signInWithEmailAndPassword(email, password)
                .then(() => {
                    console.log("Login successful!");
                })
                .catch(error => {
                    console.error("Login error:", error);
                    alert("Login failed: " + error.message);
                });
        }

        function logout() {
            firebase.auth().signOut()
                .then(() => {
                    document.getElementById('dashboard-section').style.display = 'none';
                    document.getElementById('login-section').style.display = 'block';
                });
        }

async function upload() {
  const file = document.getElementById('file').files[0];
  if (!file) {
    alert("Please select a file first");
    return;
  }

  // Show loading state
  const uploadBtn = document.querySelector('button[onclick="upload()"]');
  uploadBtn.disabled = true;
  uploadBtn.textContent = "Uploading...";

  try {
    // Create storage reference
    const user = firebase.auth().currentUser;
    const storageRef = firebase.storage().ref();
    const fileRef = storageRef.child(`questions/${user.uid}/${Date.now()}_${file.name}`);

    // Upload with explicit timeout
    const uploadTask = fileRef.put(file);
    
    // Set timeout (5 minutes)
    const timeoutPromise = new Promise((_, reject) => {
      setTimeout(() => reject(new Error("Upload timeout exceeded")), 300000);
    });

    await Promise.race([
      uploadTask,
      timeoutPromise
    ]);

    alert("File uploaded successfully!");
    console.log("File URL:", await fileRef.getDownloadURL());
  } catch (error) {
    console.error("Upload error:", error);
    alert(`Upload failed: ${error.message}\n\nPlease check:\n1. Internet connection\n2. File size (<50MB)\n3. Try a different file`);
  } finally {
    uploadBtn.disabled = false;
    uploadBtn.textContent = "Upload";
  }
}
    </script>
</body>
</html>
